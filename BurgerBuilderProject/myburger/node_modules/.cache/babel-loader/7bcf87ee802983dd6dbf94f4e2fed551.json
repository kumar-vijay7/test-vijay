{"ast":null,"code":"import axios from 'axios';\nimport * as actionTypes from './actionTypes';\nexport var authStart = function authStart() {\n  return {\n    type: actionTypes.AUTH_START\n  };\n};\nexport var authSuccess = function authSuccess(token, userId) {\n  return {\n    type: actionTypes.AUTH_SUCCESS,\n    idToken: token,\n    userId: userId\n  };\n};\nexport var authFail = function authFail(error) {\n  return {\n    type: actionTypes.AUTH_FAIL,\n    error: error\n  };\n};\nexport var logout = function logout() {\n  localStorage.removeItem('token');\n  localStorage.removeItem('expirationTime');\n  localStorage.removeItem('userId');\n  return {\n    type: actionTypes.AUTH_LOGOUT\n  };\n};\nexport var checkAuthTimeout = function checkAuthTimeout(expirationTime) {\n  return function (dispatch) {\n    setTimeout(function () {\n      dispatch(logout());\n    }, expirationTime * 1000);\n  };\n};\nexport var auth = function auth(email, password, issignup) {\n  return function (dispatch) {\n    dispatch(authStart());\n    var authData = {\n      email: email,\n      password: password,\n      returnSecureToken: true\n    };\n    var url = 'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAcGRjmw_Sv8flmvbuDwzMn3G9_wlFG7PE';\n\n    if (!issignup) {\n      url = 'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyAcGRjmw_Sv8flmvbuDwzMn3G9_wlFG7PE';\n    }\n\n    axios.post(url, authData).then(function (response) {\n      console.log(response);\n      var expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);\n      localStorage.setItem('token', response.data.idToken);\n      localStorage.setItem('expirationDate', expirationDate);\n      localStorage.setItem('userId', response.data.localId);\n      dispatch(authSuccess(response.data.idToken, response.data.localId));\n      dispatch(checkAuthTimeout(response.data.expiresIn));\n    }).catch(function (err) {\n      console.log(err);\n      dispatch(authFail(err.response.data.error));\n    });\n  };\n};\nexport var setAuthRedirectPath = function setAuthRedirectPath(path) {\n  return {\n    type: actionTypes.SET_AUTH_REDIRECT_PATH,\n    path: path\n  };\n};\nexport var authCheckState = function authCheckState() {\n  return function (dispatch) {\n    var token = localStorage.getItem('token');\n\n    if (!token) {\n      dispatch(logout());\n    } else {\n      var expirationDate = new Date(localStorage.getItem('expirationDate'));\n\n      if (expirationDate <= new Date()) {\n        dispatch(logout());\n      } else {\n        var userId = localStorage.getItem('userId');\n        dispatch(authSuccess(token, userId));\n        dispatch(checkAuthTimeout((expirationDate.getTime() - new Date().getTime()) / 1000));\n      }\n    }\n  };\n};","map":{"version":3,"sources":["E:/ReactProjects/myburger/src/store/actions/auth.js"],"names":["axios","actionTypes","authStart","type","AUTH_START","authSuccess","token","userId","AUTH_SUCCESS","idToken","authFail","error","AUTH_FAIL","logout","localStorage","removeItem","AUTH_LOGOUT","checkAuthTimeout","expirationTime","dispatch","setTimeout","auth","email","password","issignup","authData","returnSecureToken","url","post","then","response","console","log","expirationDate","Date","getTime","data","expiresIn","setItem","localId","catch","err","setAuthRedirectPath","path","SET_AUTH_REDIRECT_PATH","authCheckState","getItem"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport * as actionTypes from './actionTypes';\r\n\r\nexport const authStart=()=>{\r\n return {\r\n     type:actionTypes.AUTH_START\r\n };\r\n};\r\n\r\nexport const authSuccess= (token,userId) =>{\r\n    return {\r\n        type:actionTypes.AUTH_SUCCESS,\r\n        idToken:token,\r\n        userId: userId\r\n    };\r\n};\r\n\r\nexport const authFail =(error)=>{\r\n    return{\r\n        type : actionTypes.AUTH_FAIL,\r\n        error:error\r\n    };\r\n};\r\nexport const logout=()=>{\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('expirationTime');\r\n    localStorage.removeItem('userId');\r\n    return{\r\n        type:actionTypes.AUTH_LOGOUT \r\n    };\r\n};  \r\n\r\nexport const checkAuthTimeout=(expirationTime)=>{\r\n    return dispatch=>{\r\n           setTimeout(()=>{\r\n               dispatch(logout());\r\n           },expirationTime*1000)\r\n    };\r\n};\r\n\r\nexport const auth= (email,password,issignup)=>{\r\n    return dispatch=> {\r\n        dispatch(authStart());\r\n   const  authData={\r\n            email:email,\r\n            password:password,\r\n            returnSecureToken:true\r\n\r\n        };\r\n        let url='https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAcGRjmw_Sv8flmvbuDwzMn3G9_wlFG7PE';\r\n        if(!issignup){\r\n            url='https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyAcGRjmw_Sv8flmvbuDwzMn3G9_wlFG7PE';\r\n         }\r\n        axios.post(url,authData)\r\n        .then(response=>{\r\n            console.log(response);\r\n            const expirationDate=new Date(new Date().getTime()+response.data.expiresIn*1000);\r\n            localStorage.setItem('token',response.data.idToken);\r\n            localStorage.setItem('expirationDate',expirationDate);\r\n           localStorage.setItem('userId',response.data.localId);\r\n            dispatch(authSuccess(response.data.idToken,response.data.localId));\r\n            dispatch(checkAuthTimeout(response.data.expiresIn));\r\n        })\r\n        .catch(err=>{\r\n            console.log(err);\r\n            dispatch(authFail(err.response.data.error));\r\n        })\r\n    };\r\n};\r\n\r\nexport const setAuthRedirectPath=(path)=>{\r\n    return{\r\n        type:actionTypes.SET_AUTH_REDIRECT_PATH,\r\n        path:path\r\n    };\r\n};\r\n\r\nexport const authCheckState=()=>{\r\n    return dispatch=>{\r\n        const token = localStorage.getItem('token');\r\n        if(!token){\r\n            dispatch(logout());\r\n        }else{\r\n            const expirationDate = new Date( localStorage.getItem('expirationDate'));\r\n            if(expirationDate<=new Date()){\r\n                dispatch(logout()); \r\n            }else{\r\n                const userId = localStorage.getItem('userId');\r\n            dispatch(authSuccess(token,userId));\r\n            dispatch(checkAuthTimeout((expirationDate.getTime()- new Date().getTime())/1000));\r\n        }\r\n        }\r\n    };\r\n};"]},"metadata":{},"sourceType":"module"}